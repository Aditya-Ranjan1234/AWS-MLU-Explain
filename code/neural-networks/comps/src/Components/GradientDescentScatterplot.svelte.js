import{SvelteComponent as t,init as e,safe_not_equal as r,element as s,svg_element as o,empty as l,attr as n,add_render_callback as i,insert as c,append as a,add_resize_listener as f,noop as d,detach as m,destroy_each as h,component_subscribe as g,onMount as u,set_store_value as p,text as $,set_data as y,identity as b}from"../../node_modules/svelte/internal/index.mjs.js";import{tweened as x}from"../../node_modules/svelte/motion/index.mjs.js";import{mseData as k}from"../datasets.js";import{gdHeight as q,gdWidth as j,gdWeight as v,gdBias as w,shuffleIteration as _,gdIteration as D,gdError as B,gdErrors as G}from"../store.js";import{format as I}from"../../node_modules/d3-format/src/defaultLocale.js";import N from"../../node_modules/d3-scale/src/linear.js";import C from"../../node_modules/d3-array/src/min.js";import E from"../../node_modules/d3-array/src/max.js";import H from"../../node_modules/d3-shape/src/line.js";function L(t,e,r){const s=t.slice();return s[18]=e[r],s}function R(t,e,r){const s=t.slice();return s[21]=e[r],s}function W(t,e,r){const s=t.slice();return s[21]=e[r],s}function z(t){let e,r,s,l,i,f,d=t[8](t[21])+"";return{c(){e=o("g"),r=o("line"),l=o("text"),i=$(d),n(r,"class","grid-line svelte-67btsd"),n(r,"x1","0"),n(r,"x2","0"),n(r,"y1","0"),n(r,"y2",s=-t[2]+t[7].bottom+t[7].top),n(r,"stroke","black"),n(r,"stroke-dasharray","4"),n(l,"class","axis-text svelte-67btsd"),n(l,"y","15"),n(l,"text-anchor","middle"),n(e,"transform",f=`translate(${t[1](t[21])+0} ${t[2]-t[7].bottom})`)},m(t,s){c(t,e,s),a(e,r),a(e,l),a(l,i)},p(t,o){4&o&&s!==(s=-t[2]+t[7].bottom+t[7].top)&&n(r,"y2",s),2&o&&d!==(d=t[8](t[21])+"")&&y(i,d),6&o&&f!==(f=`translate(${t[1](t[21])+0} ${t[2]-t[7].bottom})`)&&n(e,"transform",f)},d(t){t&&m(e)}}}function A(t){let e,r,s,l,i,f,d=t[8](t[21])+"";return{c(){e=o("g"),r=o("line"),l=o("text"),i=$(d),n(r,"class","grid-line svelte-67btsd"),n(r,"x1",5),n(r,"x2",s=t[4]-t[7].right),n(r,"y1","0"),n(r,"y2","0"),n(r,"stroke","black"),n(r,"stroke-dasharray","4"),n(l,"class","axis-text svelte-67btsd"),n(l,"y","0"),n(l,"text-anchor","end"),n(l,"dominant-baseline","middle"),n(e,"transform",f=`translate(${t[7].left-5} ${t[0](t[21])+0})`)},m(t,s){c(t,e,s),a(e,r),a(e,l),a(l,i)},p(t,o){16&o&&s!==(s=t[4]-t[7].right)&&n(r,"x2",s),1&o&&d!==(d=t[8](t[21])+"")&&y(i,d),1&o&&f!==(f=`translate(${t[7].left-5} ${t[0](t[21])+0})`)&&n(e,"transform",f)},d(t){t&&m(e)}}}function F(t){let e,r,s;return{c(){e=o("circle"),n(e,"class","regression-circle svelte-67btsd"),n(e,"fill","#c9208a"),n(e,"stroke","black"),n(e,"stroke-width","1.5"),n(e,"r","4.5"),n(e,"cx",r=t[1](t[18].sqft)),n(e,"cy",s=t[0](t[18].price))},m(t,r){c(t,e,r)},p(t,o){10&o&&r!==(r=t[1](t[18].sqft))&&n(e,"cx",r),9&o&&s!==(s=t[0](t[18].price))&&n(e,"cy",s)},d(t){t&&m(e)}}}function J(t){let e,r,g,u,p,$,y,b,x,k,q,j,v=t[1].ticks(),w=[];for(let e=0;e<v.length;e+=1)w[e]=z(W(t,v,e));let _=t[0].ticks(),D=[];for(let e=0;e<_.length;e+=1)D[e]=A(R(t,_,e));let B=t[3],G=[];for(let e=0;e<B.length;e+=1)G[e]=F(L(t,B,e));return{c(){e=s("div"),r=o("svg");for(let t=0;t<w.length;t+=1)w[t].c();g=l();for(let t=0;t<D.length;t+=1)D[t].c();u=o("line"),y=o("line"),x=o("path");for(let t=0;t<G.length;t+=1)G[t].c();n(u,"class","axis-line"),n(u,"y1",p=t[2]-t[7].bottom),n(u,"y2",$=t[2]-t[7].bottom),n(u,"x1",t[7].left),n(u,"x2",t[4]),n(u,"stroke","black"),n(u,"stroke-width","1"),n(y,"class","axis-line"),n(y,"y1",t[7].top),n(y,"y2",b=t[2]-t[7].bottom),n(y,"x1",t[7].left),n(y,"x2",t[7].left),n(y,"stroke","black"),n(y,"stroke-width","1"),n(x,"class","regression-line svelte-67btsd"),n(x,"d",k=t[5](t[3])),n(r,"width",t[4]),n(r,"height",q=t[2]+t[7].top+t[7].bottom),n(e,"id","scatter-chart-gd"),n(e,"class","svelte-67btsd"),i((()=>t[17].call(e)))},m(s,o){c(s,e,o),a(e,r);for(let t=0;t<w.length;t+=1)w[t].m(r,null);a(r,g);for(let t=0;t<D.length;t+=1)D[t].m(r,null);a(r,u),a(r,y),a(r,x);for(let t=0;t<G.length;t+=1)G[t].m(r,null);j=f(e,t[17].bind(e))},p(t,[e]){if(390&e){let s;for(v=t[1].ticks(),s=0;s<v.length;s+=1){const o=W(t,v,s);w[s]?w[s].p(o,e):(w[s]=z(o),w[s].c(),w[s].m(r,g))}for(;s<w.length;s+=1)w[s].d(1);w.length=v.length}if(401&e){let s;for(_=t[0].ticks(),s=0;s<_.length;s+=1){const o=R(t,_,s);D[s]?D[s].p(o,e):(D[s]=A(o),D[s].c(),D[s].m(r,u))}for(;s<D.length;s+=1)D[s].d(1);D.length=_.length}if(4&e&&p!==(p=t[2]-t[7].bottom)&&n(u,"y1",p),4&e&&$!==($=t[2]-t[7].bottom)&&n(u,"y2",$),16&e&&n(u,"x2",t[4]),4&e&&b!==(b=t[2]-t[7].bottom)&&n(y,"y2",b),40&e&&k!==(k=t[5](t[3]))&&n(x,"d",k),11&e){let s;for(B=t[3],s=0;s<B.length;s+=1){const o=L(t,B,s);G[s]?G[s].p(o,e):(G[s]=F(o),G[s].c(),G[s].m(r,null))}for(;s<G.length;s+=1)G[s].d(1);G.length=B.length}16&e&&n(r,"width",t[4]),4&e&&q!==(q=t[2]+t[7].top+t[7].bottom)&&n(r,"height",q)},i:d,o:d,d(t){t&&m(e),h(w,t),h(D,t),h(G,t),j()}}}function K(t,e,r){let s,o,l,n,i,c,a,f,d,m,h,$;g(t,q,(t=>r(2,n=t))),g(t,j,(t=>r(4,c=t))),g(t,v,(t=>r(11,a=t))),g(t,w,(t=>r(12,f=t))),g(t,_,(t=>r(13,d=t))),g(t,D,(t=>r(14,m=t))),g(t,B,(t=>r(15,h=t))),g(t,G,(t=>r(16,$=t))),u((()=>{const t=document.getElementById("scatter-chart-gd").getBoundingClientRect();p(j,c=0==c?t.width:c,c),p(q,n=0==n?t.height:n,n)}));const y=x(k.map((t=>({sqft:t[`sqft${d}`],y:f+a*t[`sqft${d}`],price:t[`price${d}`]}))),{duration:300,easing:b});g(t,y,(t=>r(3,i=t)));const L={top:12,bottom:3,left:40,right:30},R=I(".2r");return t.$$.update=()=>{if(14336&t.$$.dirty&&y.set(k.map((t=>({sqft:t[`sqft${d}`],y:f+a*t[`sqft${d}`],price:t[`price${d}`]})))),22528&t.$$.dirty&&p(D,m+=1,m),129024&t.$$.dirty){let t=k.map((t=>(t[`price${d}`]-(a*t[`sqft${d}`]+f))**2));p(B,h=Number(t.reduce(((t,e)=>t+e),0))/t.length,h),p(G,$=[...$,{iteration:m,error:h}],$)}24&t.$$.dirty&&r(1,s=N().domain([C(i,(t=>t.sqft))-2,E(i,(t=>t.sqft))+2]).range([L.left,c-L.right])),12&t.$$.dirty&&r(0,o=N().domain([C(i,(t=>t.price))-2,E(i,(t=>t.price))+2]).range([n-L.bottom,L.top])),3&t.$$.dirty&&r(5,l=H().x((t=>s(t.sqft))).y((t=>o(t.y))))},[o,s,n,i,c,l,y,L,R,function(){p(_,d=(d+1)%10,d),y.set(k.map((t=>({sqft:t[`sqft${d}`],y:f+a*t[`sqft${d}`],price:t[`price${d}`]})))),p(D,m=0,m),p(G,$=[{iteration:0,error:h}],$),p(w,f=1,f),p(v,a=0,a)},function(t){const e=k.length;console.log("N",e),p(D,m+=t-1,m),console.log("shuffleIteration",d);for(let r=0;r<t;r++){let t=k.map((t=>{let e=a*t[`sqft${d}`]+f;return t[`sqft${d}`]*(t[`price${d}`]-e)})),r=k.map((t=>{let e=a*t[`sqft${d}`]+f;return t[`price${d}`]-e})),s=t.reduce(((t,e)=>t+e),0);p(v,a=a-.001*(-2/e*s),a);let o=r.reduce(((t,e)=>t+e),0);p(w,f=f-.001*(-2/e*o),f)}console.log("bias:",f,"weight:",a)},a,f,d,m,h,$,function(){c=this.offsetWidth,j.set(c),n=this.offsetHeight,q.set(n)}]}class M extends t{constructor(t){super(),e(this,t,K,J,r,{shuffleData:9,runGradientDescent:10})}get shuffleData(){return this.$$.ctx[9]}get runGradientDescent(){return this.$$.ctx[10]}}export{M as default};
